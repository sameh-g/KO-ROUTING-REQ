!function(){var e=function(e){function t(e,t){if(e.indexOf)return e.indexOf(t);for(var r=e.length;r--;)if(e[r]===t)return r;return-1}function r(e,r){var n=t(e,r);n!==-1&&e.splice(n,1)}function n(e,t){return"[object "+t+"]"===Object.prototype.toString.call(e)}function i(e){return n(e,"RegExp")}function s(e){return n(e,"Array")}function a(e){return"function"==typeof e}function o(e){var t;return t=null===e||"null"===e?null:"true"===e||"false"!==e&&(e===f||"undefined"===e?f:""===e||isNaN(e)?e:parseFloat(e))}function u(e){for(var t=e.length,r=[];t--;)r[t]=o(e[t]);return r}function h(e,t){for(var r,n,i=(e||"").replace("?","").split("&"),s=i.length,a={};s--;)r=i[s].split("="),n=t?o(r[1]):r[1],a[r[0]]="string"==typeof n?decodeURIComponent(n):n;return a}function p(){this.bypassed=new e.Signal,this.routed=new e.Signal,this._routes=[],this._prevRoutes=[],this._piped=[],this.resetState()}function c(t,r,n,s){var a=i(t),o=s.patternLexer;this._router=s,this._pattern=t,this._paramsIds=a?null:o.getParamIds(t),this._optionalParamsIds=a?null:o.getOptionalParamsIds(t),this._matchRegexp=a?t:o.compilePattern(t,s.ignoreCase),this.matched=new e.Signal,this.switched=new e.Signal,r&&this.matched.add(r),this._priority=n||0}var l,d,f;return d=""===/t(.+)?/.exec("t")[1],p.prototype={greedy:!1,greedyEnabled:!0,ignoreCase:!0,ignoreState:!1,shouldTypecast:!1,normalizeFn:null,resetState:function(){this._prevRoutes.length=0,this._prevMatchedRequest=null,this._prevBypassedRequest=null},create:function(){return new p},addRoute:function(e,t,r){var n=new c(e,t,r,this);return this._sortedInsert(n),n},removeRoute:function(e){r(this._routes,e),e._destroy()},removeAllRoutes:function(){for(var e=this.getNumRoutes();e--;)this._routes[e]._destroy();this._routes.length=0},parse:function(e,t){if(e=e||"",t=t||[],this.ignoreState||e!==this._prevMatchedRequest&&e!==this._prevBypassedRequest){var r,n=this._getMatchedRoutes(e),i=0,s=n.length;if(s)for(this._prevMatchedRequest=e,this._notifyPrevRoutes(n,e),this._prevRoutes=n;i<s;)r=n[i],r.route.matched.dispatch.apply(r.route.matched,t.concat(r.params)),r.isFirst=!i,this.routed.dispatch.apply(this.routed,t.concat([e,r])),i+=1;else this._prevBypassedRequest=e,this.bypassed.dispatch.apply(this.bypassed,t.concat([e]));this._pipeParse(e,t)}},_notifyPrevRoutes:function(e,t){for(var r,n=0;r=this._prevRoutes[n++];)r.route.switched&&this._didSwitch(r.route,e)&&r.route.switched.dispatch(t)},_didSwitch:function(e,t){for(var r,n=0;r=t[n++];)if(r.route===e)return!1;return!0},_pipeParse:function(e,t){for(var r,n=0;r=this._piped[n++];)r.parse(e,t)},getNumRoutes:function(){return this._routes.length},_sortedInsert:function(e){var t=this._routes,r=t.length;do--r;while(t[r]&&e._priority<=t[r]._priority);t.splice(r+1,0,e)},_getMatchedRoutes:function(e){for(var t,r=[],n=this._routes,i=n.length;(t=n[--i])&&((!r.length||this.greedy||t.greedy)&&t.match(e)&&r.push({route:t,params:t._getParamsArray(e)}),this.greedyEnabled||!r.length););return r},pipe:function(e){this._piped.push(e)},unpipe:function(e){r(this._piped,e)},toString:function(){return"[crossroads numRoutes:"+this.getNumRoutes()+"]"}},l=new p,l.VERSION="0.12.0",l.NORM_AS_ARRAY=function(e,t){return[t.vals_]},l.NORM_AS_OBJECT=function(e,t){return[t]},c.prototype={greedy:!1,rules:void 0,match:function(e){return e=e||"",this._matchRegexp.test(e)&&this._validateParams(e)},_validateParams:function(e){var t,r=this.rules,n=this._getParamsObject(e);for(t in r)if("normalize_"!==t&&r.hasOwnProperty(t)&&!this._isValidParam(e,t,n))return!1;return!0},_isValidParam:function(e,r,n){var o=this.rules[r],u=n[r],h=!1,p=0===r.indexOf("?");return null==u&&this._optionalParamsIds&&t(this._optionalParamsIds,r)!==-1?h=!0:i(o)?(p&&(u=n[r+"_"]),h=o.test(u)):s(o)?(p&&(u=n[r+"_"]),h=this._isValidArrayRule(o,u)):a(o)&&(h=o(u,e,n)),h},_isValidArrayRule:function(e,r){if(!this._router.ignoreCase)return t(e,r)!==-1;"string"==typeof r&&(r=r.toLowerCase());for(var n,i,s=e.length;s--;)if(n=e[s],i="string"==typeof n?n.toLowerCase():n,i===r)return!0;return!1},_getParamsObject:function(e){for(var r,n,i=this._router.shouldTypecast,s=this._router.patternLexer.getParamValues(e,this._matchRegexp,i),a={},u=s.length;u--;)n=s[u],this._paramsIds&&(r=this._paramsIds[u],0===r.indexOf("?")&&n&&(a[r+"_"]=n,n=h(n,i),s[u]=n),d&&""===n&&t(this._optionalParamsIds,r)!==-1&&(n=void 0,s[u]=n),a[r]=n),a[u]=n;return a.request_=i?o(e):e,a.vals_=s,a},_getParamsArray:function(e){var t,r=this.rules?this.rules.normalize_:null;return r=r||this._router.normalizeFn,t=r&&a(r)?r(e,this._getParamsObject(e)):this._getParamsObject(e).vals_},interpolate:function(e){var t=this._router.patternLexer.interpolate(this._pattern,e);if(!this._validateParams(t))throw new Error("Generated string doesn't validate against `Route.rules`.");return t},dispose:function(){this._router.removeRoute(this)},_destroy:function(){this.matched.dispose(),this.switched.dispose(),this.matched=this.switched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}},p.prototype.patternLexer=function(){function e(){var e,t;for(e in d)d.hasOwnProperty(e)&&(t=d[e],t.id="__CR_"+e+"__",t.save="save"in t?t.save.replace("{{id}}",t.id):t.id,t.rRestore=new RegExp(t.id,"g"))}function t(e,t){var r,n=[];for(e.lastIndex=0;r=e.exec(t);)n.push(r[1]);return n}function r(e){return t(l,e)}function n(e){return t(d.OP.rgx,e)}function i(e,t){return e=e||"",e&&(v===f?e=e.replace(p,""):v===_&&(e=e.replace(c,"")),e=s(e,"rgx","save"),e=e.replace(h,"\\$&"),e=s(e,"rRestore","res"),v===f&&(e="\\/?"+e)),v!==g&&(e+="\\/?"),new RegExp("^"+e+"$",t?"i":"")}function s(e,t,r){var n,i;for(i in d)d.hasOwnProperty(i)&&(n=d[i],e=e.replace(n[t],n[r]));return e}function a(e,t,r){var n=t.exec(e);return n&&(n.shift(),r&&(n=u(n))),n}function o(e,t){if("string"!=typeof e)throw new Error("Route pattern should be a string.");var r=function(e,r){var n;if(r="?"===r.substr(0,1)?r.substr(1):r,null!=t[r]){if("object"==typeof t[r]){var i=[];for(var s in t[r])i.push(encodeURI(s+"="+t[r][s]));n="?"+i.join("&")}else n=String(t[r]);if(e.indexOf("*")===-1&&n.indexOf("/")!==-1)throw new Error('Invalid value "'+n+'" for segment "'+e+'".')}else{if(e.indexOf("{")!==-1)throw new Error("The segment "+e+" is required.");n=""}return n};return d.OS.trail||(d.OS.trail=new RegExp("(?:"+d.OS.id+")+$")),e.replace(d.OS.rgx,d.OS.save).replace(l,r).replace(d.OS.trail,"").replace(d.OS.rRestore,"/")}var h=/[\\.+*?\^$\[\](){}\/'#]/g,p=/^\/|\/$/g,c=/\/$/g,l=/(?:\{|:)([^}:]+)(?:\}|:)/g,d={OS:{rgx:/([:}]|\w(?=\/))\/?(:|(?:\{\?))/g,save:"$1{{id}}$2",res:"\\/?"},RS:{rgx:/([:}])\/?(\{)/g,save:"$1{{id}}$2",res:"\\/"},RQ:{rgx:/\{\?([^}]+)\}/g,res:"\\?([^#]+)"},OQ:{rgx:/:\?([^:]+):/g,res:"(?:\\?([^#]*))?"},OR:{rgx:/:([^:]+)\*:/g,res:"(.*)?"},RR:{rgx:/\{([^}]+)\*\}/g,res:"(.+)"},RP:{rgx:/\{([^}]+)\}/g,res:"([^\\/?]+)"},OP:{rgx:/:([^:]+):/g,res:"([^\\/?]+)?/?"}},f=1,g=2,_=3,v=f;return e(),{strict:function(){v=g},loose:function(){v=f},legacy:function(){v=_},getParamIds:r,getOptionalParamsIds:n,getParamValues:a,compilePattern:i,interpolate:o}}(),l};"function"==typeof define&&define.amd?define(["signals"],e):"undefined"!=typeof module&&module.exports?module.exports=e(require("signals")):window.crossroads=e(window.signals)}();